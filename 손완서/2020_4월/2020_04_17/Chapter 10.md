# Chapter 10. 웹 API 서버 만들기

## 10.1 API 서버 이해하기

API는 다른 애플리케이션에서 현재 프로그램의 기능을 사용할 수 있게 허용하는 접점을 의미합니다.

웹 API는 다른 웹 서비스의 기능을 사용하거나 자원을 가져올 수 있는 창구입니다.
흔히 API를 열었다 또는 만들었다고 표현하는데, 이는 다른 프로그램에서 현재 기능을 사용할 수 있게 허용하였음을 뜻합니다.

크롤링은 웹 사이트가 자체적으로 제공하는 API가 없거나, API 이용에 제한이 있을 때 사용하는 방법입니다.
표면적으로 보이는 웹 사이트의 정보를 일정 주기로 수집해 자체적으로 가공하는 기술입니다.

## 10.2 프로젝트 구조 갖추기

다른 서비스에 NodeBird 서비스의 게시글, 해시태그, 사용자 정보를 JSON 형식으로 제공할 것입니다.
단, 인증을 받은 사용자에게나 일정한 할당량 안에서 API를 호출할 수 있도록 허용할 것입니다.

도메인 모델에는 인터넷 주소와 도메인 종류, 클라이언트 비밀키가 들어갑니다.
클라이언트 비밀키는 API를 사용할 때 필요한 비밀키입니다.

validate는 데이터를 추가로 검증하는 속성입니다.

루트 라우터는 접속 시 로그인 화면을 보여주며, 도메인 등록 라우터는 폼으로부터 온 데이터를 도메인 모델에 저장합니다.

uuid는 범용 고유 식별자로 고유한 문자열을 만들고 싶을 때 사용합니다.

도메인을 등록하는 이유는 등록한 도메인에서만 API를 사용할 수 있게 하기 위해서입니다.
웹 브라우저에서 요청을 보낼 때, 응답을 하는 곳과 도메인이 다르면 CORS 에러가 발생할 수가 있습니다.

## 10.3 JWT 토큰으로 인증하기

JWT는 JSON Web Token의 약어로, JSON 형식의 데이터를 저장하는 토큰입니다.
JWT는 헤더, 페이로드, 시그니처로 구성되어 있습니다.

- 헤더: 토큰 종류와 해시 알고리즘 정보가 들어 있습니다.
- 페이로드: 토큰의 내용물이 인코딩된 부분입니다.
- 시그니처: 일련의 문자열로, 시그니처를 통해 토큰이 변조되었는지 여부를 확인할 수 있습니다.

시그니처는 JWT 비밀키로 만들어집니다.

JWT에는 민감한 내용을 넣어서는 안됩니다.

JWT 토큰은 JWT 비밀키를 알지 않는 이상 변조가 불가능합니다.
변조한 토큰은 시그니처를 검사할 때 들통납니다.

단점은 용량이 크다는 것입니다.
매 요청 시 토큰이 오고 가기 때문에 데이터 양이 증가합니다.

요청 헤더에 저장된 토큰을 사용합니다.
jwt.verify 메서드로 토큰을 검증할 수 있습니다.
메서드의 첫 번째 인자로는 토큰을, 두 번째 인자로는 토큰의 비밀키를 넣어줍니다.

토큰의 비밀키가 일치하지 않는다면 인증을 받을 수 없습니다.
그런 경우네는 에러가 발생하여 catch문으로 이동하게 됩니다.

sign 메서드의 첫 번째 인자로 토큰의 내용입니다.
두 번째 인자는 토큰의 비밀키입니다.
세 번째 인자는 토큰의 설정입니다.

## 10.4 호출 서버 만들기

API를 통해 가져온 데이터는 JSON 형태이므로 Pug나 EJS 같은 템플릿 엔진으로 데이터를 렌더링할 수도 있습니다.

axios.get(주소, { headers: { 헤더 } })를 하면 해당 주소에 헤더와 함께 GET 요청을 보내는 것이고, axios.pos(주소, { 데이터 })를 하면 해당 주소에 POST 요청을 보내면서 요청 본문에 데이터를 실어 보내는 것입니다.
보통 토큰은 HTTP 요청 헤더에 넣어서 보냅니다.
result.data나 tokenResult.data가 API 서버에서 보내주는 응답 값입니다.
