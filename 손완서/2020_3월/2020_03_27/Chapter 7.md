# Chapter 7. MySQL

변수에 저장했다는 것은 컴퓨터 메모리에 저장했다는 뜻입니다.
서버가 종료되면 메모리가 정리되면서 저장했던 데이터도 사라져 버립니다.
이를 방지하기 위해서는 데이터베이스를 사용해야 합니다.

## 7.1 데이터베이스란?

데이터베이스는 관련성을 가지며 중복이 없는 데이터들의 집합입니다.
이러한 데이터베이스를 관리하는 시스템을 DBMS라고 부릅니다.

보통 서버의 하드 디스크나 SSD 등의 저장 매체에 데이터를 저장합니다.
저장 매체가 고장나거나 사용자가 직접 데이터를 지우지 않는 이상 계속 데이터가 보존되므로 서버 종료 여부와 상관 없이 데이터를 계속 사용할 수 있습니다.

또한, 서버에 데이터베이스를 올리면 여러 사람이 동시에 사용할 수 있습니다.
사람들에게 각각 다른 권한을 주어 어떤 사람은 읽기만 가능하고, 어떤 사람은 모든 작업을 가능하게 할 수 있습니다.

데이터베이스를 관리하는 DBMS 중에는 RDBMS라고 부르는 관계형 DBMS가 많이 사용됩니다.

## 7.4 데이터베이스 및 테이블 생성하기

### 7.4.1 데이터베이스 생성하기

CREATE SCHEMA [데이터베이스명]이 데이터베이스를 생성하는 명령어입니다.
MySQL에서는 데이터베이스와 Schema는 같은 개념입니다.
그 후 use nodejs; 명령어를 추가로 입력하여 앞으로 nodejs 데이터베이스를 사용하겠다는 것을 MySQL에 알립니다.

SQL 구문을 입력할 때는 마지막에 세미콜록(;)을 붙여야 실행됩니다

MySQL이 기본적으로 알고 있는 구문을 예약어라고 부릅니다.

### 7.4.2 테이블 생성하기

테이블이란 데이터가 들어갈 수 있는 틀을 의미합니다.
테이블에 맞는 데이터만 들어갈 수 있습니다.

CREATE TABLE [데이터베이스명.테이블명]은 테이블을 생성하는 명령어입니다.
컬럼을 정의해두면 데이터를 넣을 때 컬럼 규칙에 맞는 정보들만 넣을 수 있습니다.

INT는 정수를 의미합니다.
CHAR은 고정길이고, VARCHAR은 가변길이입니다.
TEXT는 긴 글을 저장할 때 사용합니다.
TINYINT는 -127부터 128까지의 정수를 저장할 때 사용합니다.
DATETIME은 날짜와 시간에 대한 정보를 담고 있습니다.
NULL과 NOT NULL은 빈칸을 허용할지 여부를 묻는 옵션입니다.
AUTO_INCREMENT는 숫자를 저절로 올리겠다는 뜻입니다.
UNSIGNED는 숫자 자료형에 적용되는 옵션입니다.
ZEROFILL은 숫자의 자릿수가 고정되어 있을 때 사용할 수 있습니다. 빈 자리를 모두 0으로 채웁니다.
create_at에는 DEFAULT now()라는 옵션이 붙어 있습니다. 데이터베이스 저장 시 해당 컬럼에 값이 없을 때 MySQL이 기본값을 대신 넣어줍니다. now()는 현재 시각을 넣으라는 뜻입니다.
해당컬럼이 기본 키인 경우에 PRIMARY KEY 옵션을 설정합니다. 기본 키란 로우를 대표하는 고유한 값을 의미합니다. 데이터베이스에 데이터를 넣을 때 로우 단위로 넣습니다.
UNIQUE INDEX는 해당 값이 고유해야 하는지에 대한 옵션입니다.
COMMENT는 테이블에 대한 보충 설명을 의미합니다.
DEFAULT CHARSET을 utf8로 설정하지 않으면 한글이 입력되지 않으니 반드시 설정해야 합니다.
ENGINE은 여러 가지가 있지만, MyISAM과 InnoDB가 제일 많이 사용됩니다.

만들어진 테이블을 확인하는 명령어는 DESC 테이블명입니다.

DROP TABLE [테이블명] 명령어를 입력하면 제거됩니다.

다른 테이블의 기본 키를 저장하는 컬럼을 외래 키라고 부릅니다.
CONSTRAINT [제약조건명] FOREIGN KEY [컬럼명] REFERENCES [참고하는 컬럼명]으로 외래 키를 지정할 수 있습니다.

ON UPDATE와 ON DELETE는 모두 CASCADE로 설정했습니다.
사용자 정보가 수정되거나 삭제되면 그것과 연결된 댓글 정보도 같이 수정하거나 삭제한다는 뜻입니다.

## 7.5 CRUD 작업하기

CRUD란 Create, Read, Update, Delete의 두문자어로, 데이터베이스에서 많이 하는 작업 네 가지를 일컫습니다.

### 7.5.1 Create(생성)

Create(생성)는 데이터를 생성해서 데이터베이스에 넣는 작업입니다.

데이터를 넣는 명령어는 INSERT INTO [테이블명] ([컬럼1], [컬럼2], ...) VALUES ([값1], [값2], ...)입니다.

### 7.5.2 Read(조회)

Read(조회)는 데이터베이스에 있는 데이터를 조회하는 작업입니다.

테이블의 모든 데이터를 조회하는 SQL문은 SELECT \* FROM [테이블명] 형식입니다.

특정 컬럼만 조회할 수도 있습니다.

WHERE 절을 사용하면 특정 조건을 가진 데이터만 조회할 수도 있습니다.

AND가 조건들을 모두 만족하는 데이터를 찾는다면 OR는 조건들 중 어느 하나라도 만족하는 데이터를 찾습니다.

ORDER BY [컬럼명][asc|desc] 키워드를 사용하면 정렬도 가능합니다.
DESC는 내림차순, ASC는 오름차순입니다.

조회할 로우 개수를 설정할 수도 있습니다.
LIMIT [숫자] 키워드를 사용합니다.

로우 개수를 설정하면서 몇 개를 건너뛸지 설정할 수도 있습니다.
OFFSET [건너뛸 숫자] 키워드를 사용합니다.

### 7.5.3 Update(수정)

Update(수정)는 데이터베이스에 있는 데이터를 수정하는 작업입니다.

수정 명령어는 UPDATE [테이블명] SET [컬럼명=바꿀 값] WHERE [조건]입니다.
조건도 AND나 OR로 여러 개를 동시에 사용할 수 있습니다.

### 7.5.4 Delete(삭제)

Delete(삭제)는 데이터베이스에 있는 데이터를 삭제하는 작업입니다.

삭제 명령어는 DELETE FROM [테이블명] WHERE [조건]입니다.

## 7.6 시퀄라이즈 사용하기

MySQL 작업을 쉽게 할 수 있도록 도와주는 라이브러리는 Sequelize(시퀄라이즈)입니다.

시퀄라이즈는 ORM으로 분류됩니다.
ORM은 자바스크립트 객체와 데이터베이스의 릴레이션을 매핑해주는 도구입니다.

시퀄라이즈를 쓰는 이유는 자바스크립트 구문을 알아서 SQL로 바꿔주기 때문입니다.

### 7.6.1 MySQL 연결하기

폴더 내의 index.js 파일은 require 시 이름을 생략할 수 있습니다.

sync 메서드를 사용하면 서버 실행 시 알아서 MySQL과 연동됩니다.

### 7.6.2 모델 정의하기

MySQL에서 정의한 테이블을 시퀄라이즈에서도 정의해야 합니다.
시퀄라이즈는 모델과 MySQL의 테이블을 연결해주는 역할을 합니다.
시퀄라이즈는 기본적으로 모델 이름은 단수형으로, 테이블 이름은 복수형으로 사용합니다.

시퀄라이즈는 알아서 id를 기본 키로 연결하므로 id 컬럼은 적어줄 필요가 없습니다.
sequelize.define 메서드로 테이블명과 각 컬럼의 스펙을 입력합니다.

시퀄라이즈의 자료형은 MySQL의 자료형과는 조금 다릅니다.

define 메서드의 세 번째 인자는 테이블 옵션입니다.
timestamps 속성이 true면 시퀄라이즈는 createAt과 updatedAt 컬럼을 추가합니다.

### 7.6.3 관계 정의하기

1:N 관계에서는 사용자가 1이고, 댓글이 N입니다.

다른 관계로 일대일, 다대다 관계가 있습니다.

MySQL에서는 JOIN이라는 기능으로 여러 테이블 간의 관계를 파악해 결과를 도출합니다.

#### 7.6.3.1 1:N

시퀄라이즈에서는 1:N 관계를 hasMany라는 메서드로 표현합니다.
users 테이블의 로우 하나를 불러올 때 연결된 comments 테이블의 로우들도 같이 불러올 수 있습니다.
반대로 belongsTo 메서드도 있습니다.
comments 테이블의 로우를 불러올 때 연결된 users 테이블의 로우를 가져옵니다.

#### 7.6.3.2 1:1

1:1 관계에서는 hasMany 메서드 대신 hasOne 메서드를 사용합니다.
